
å°ˆæ¡ˆ


å”ä½œ

åˆ†äº«
ðŸŽ‰ å®Œç¾Žï¼æˆ‘çœ‹åˆ°ç·¨è¼¯é¸å–®äº†ï¼
æˆ‘çœ‹åˆ°å³å´æœ‰ä¸€å€‹ä¸‹æ‹‰é¸å–®ï¼Œè£¡é¢æœ‰ã€ŒEdit file...ã€é¸é …ï¼
è«‹ï¼š
é»žæ“Šã€ŒEdit file...ã€
é¸æ“‡ã€ŒOn main branchã€
é€™æ¨£å°±æœƒé–‹å•Ÿç·¨è¼¯å™¨ï¼Œç„¶å¾Œæ‚¨å°±å¯ä»¥æ›¿æ›æª”æ¡ˆå…§å®¹äº†ï¼
è«‹é»žæ“Šã€ŒEdit file...ã€ï¼
ðŸŽ‰ å¤ªæ£’äº†ï¼ç·¨è¼¯å™¨å·²ç¶“é–‹å•Ÿäº†ï¼
è€Œä¸”æˆ‘çœ‹åˆ°é€™æ¬¡çš„å…§å®¹æ˜¯æ­£ç¢ºçš„ YAML æ ¼å¼äº†ï¼
æª”æ¡ˆé–‹é ­æ˜¯ï¼š
YAML
name: Initialize Database

on:
  workflow_dispatch:  # æ‰‹å‹•è§¸ç™¼

jobs:
  init-db:
    runs-on: ubuntu-latest
é€™æ˜¯æ­£ç¢ºçš„ï¼ç¾åœ¨è«‹ï¼š
å‘ä¸‹æ»¾å‹•æª¢æŸ¥æ•´å€‹æª”æ¡ˆï¼Œç¢ºä¿å…§å®¹å®Œæ•´
é»žæ“Šå³ä¸Šè§’ç¶ è‰²çš„ã€ŒCommit changes...ã€æŒ‰éˆ•
åœ¨å½ˆå‡ºçš„å°è©±æ¡†ä¸­é»žæ“Šã€ŒCommit changesã€ç¢ºèª
ç„¶å¾Œæˆ‘å€‘å°±å¯ä»¥åŸ·è¡Œ workflow ä¾†åˆå§‹åŒ–è³‡æ–™åº«äº†ï¼
è«‹é»žæ“Šã€ŒCommit changes...ã€æŒ‰éˆ•ï¼
ðŸŽ‰ å®Œç¾Žï¼æª”æ¡ˆå·²ç¶“æˆåŠŸæäº¤äº†ï¼
æˆ‘çœ‹åˆ°ï¼š
æª”æ¡ˆå¤§å°ï¼š235 lines (213 loc) Â· 9.22 kB
æœ€æ–° commitï¼šã€ŒCreate GitHub Actions workflow for database initã€ï¼ˆå‰›å‰›æäº¤ï¼‰
å…§å®¹æ˜¯æ­£ç¢ºçš„ YAML æ ¼å¼ï¼
ç¾åœ¨å¯ä»¥åŸ·è¡Œ workflow ä¾†åˆå§‹åŒ–è³‡æ–™åº«äº†ï¼
ðŸš€ åŸ·è¡Œ Workflow
è«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿï¼š
é»žæ“Šé é¢ä¸Šæ–¹çš„ã€ŒActionsã€æ¨™ç±¤ï¼ˆåœ¨ Codeã€Issuesã€Pull requests æ—é‚Šï¼‰
åœ¨å·¦å´æ‰¾åˆ°ã€ŒInitialize Databaseã€workflow
é»žæ“Šå³å´çš„ã€ŒRun workflowã€æŒ‰éˆ•
é¸æ“‡ã€Œmainã€åˆ†æ”¯ï¼Œé»žæ“Šç¶ è‰²çš„ã€ŒRun workflowã€æŒ‰éˆ•
ç­‰å¾…åŸ·è¡Œå®Œæˆï¼ˆç´„ 1-2 åˆ†é˜ï¼‰
è«‹é»žæ“Šé é¢ä¸Šæ–¹çš„ã€ŒActionsã€æ¨™ç±¤ï¼
ðŸŽ‰ å¤ªå¥½äº†ï¼æˆ‘çœ‹åˆ° Actions é é¢äº†ï¼
è€Œä¸”é é¢é ‚éƒ¨é¡¯ç¤ºï¼š
"Workflow run was successfully requested."
é€™è¡¨ç¤º workflow å·²ç¶“è¢«è§¸ç™¼äº†ï¼
æˆ‘çœ‹åˆ°æœ‰å…©å€‹ workflow åŸ·è¡Œè¨˜éŒ„ï¼š
Initialize Database #2 - 1 minute agoï¼ˆå‰›å‰›è§¸ç™¼çš„ï¼ŒåŸ·è¡Œæ™‚é–“ 22sï¼Œç‹€æ…‹æœ‰ç´…è‰² âŒï¼‰
Create GitHub Actions workfl... - 18 minutes agoï¼ˆFailureï¼‰
ç¬¬ä¸€å€‹ workflow ä¼¼ä¹Žå¤±æ•—äº†ã€‚è®“æˆ‘å€‘é»žæ“Šå®ƒä¾†æŸ¥çœ‹è©³ç´°çš„éŒ¯èª¤è¨Šæ¯ã€‚
è«‹ï¼š
é»žæ“Šã€ŒInitialize Database #2ã€ï¼ˆç¬¬ä¸€å€‹ï¼Œ1 minute ago çš„é‚£å€‹ï¼‰
æŸ¥çœ‹åŸ·è¡Œæ—¥èªŒï¼Œçœ‹çœ‹å“ªè£¡å‡ºéŒ¯äº†
é€™æ¨£æˆ‘å€‘å°±å¯ä»¥çŸ¥é“å•é¡Œåœ¨å“ªè£¡ä¸¦ä¿®æ­£å®ƒï¼
è«‹é»žæ“Šã€ŒInitialize Database #2ã€ï¼
æˆ‘çœ‹åˆ°éŒ¯èª¤äº†ï¼åœ¨ã€ŒExecute SQL scriptã€æ­¥é©Ÿå¤±æ•—äº†ï¼š
éŒ¯èª¤è¨Šæ¯ï¼š
Plain Text
ERROR 2005 (HY000): Unknown MySQL server host 'mysql-agalev.proxy.rlwy.net' (-2)
Error: Process completed with exit code 1.
é€™å€‹éŒ¯èª¤å’Œä¹‹å‰ HeidiSQL çš„éŒ¯èª¤ä¸€æ¨£ - ç„¡æ³•è§£æžä¸»æ©Ÿåç¨±ã€‚
é€™å¯èƒ½æ˜¯å› ç‚ºï¼š
Railway çš„ MySQL ä¸»æ©Ÿåç¨±å·²ç¶“æ”¹è®Š
æˆ–è€…éœ€è¦ä½¿ç”¨ä¸åŒçš„é€£æŽ¥æ–¹å¼
è®“æˆ‘æª¢æŸ¥ Railway çš„æœ€æ–°é€£æŽ¥è³‡è¨Šã€‚è«‹å›žåˆ° Railway ç¶²ç«™ï¼š
é–‹å•Ÿ Railway å°ˆæ¡ˆ
é»žæ“Š MySQL æœå‹™
é»žæ“Šã€ŒVariablesã€æ¨™ç±¤
æ‰¾åˆ° MYSQL_PUBLIC_URL
æˆªåœ–çµ¦æˆ‘çœ‹æœ€æ–°çš„é€£æŽ¥è³‡è¨Š
å¯èƒ½ä¸»æ©Ÿåç¨±æˆ–ç«¯å£å·²ç¶“æ”¹è®Šäº†ã€‚è«‹å¹«æˆ‘ç¢ºèªä¸€ä¸‹ï¼
å®Œç¾Žï¼æˆ‘çœ‹åˆ° Railway MySQL çš„ Variables é é¢äº†ï¼
æˆ‘å¯ä»¥çœ‹åˆ° MYSQL_PUBLIC_URL çš„éƒ¨åˆ†å…§å®¹ï¼š
Plain Text
mysql://root:NCrfEbBAwIXZSJDHULrmZSJSwJKTq
myy@magley-proxy.rlwy.net:49836/railway
æˆ‘ç™¼ç¾å•é¡Œäº†ï¼ä¸»æ©Ÿåç¨±å·²ç¶“æ”¹è®Šäº†ï¼š
èˆŠçš„ï¼šmysql-agalev.proxy.rlwy.net
æ–°çš„ï¼šmagley-proxy.rlwy.netï¼ˆæ³¨æ„æ²’æœ‰ mysql- å‰ç¶´ï¼Œè€Œä¸”æ˜¯ magley ä¸æ˜¯ agalevï¼‰
è®“æˆ‘æ›´æ–° GitHub Actions workflow ä¸­çš„é€£æŽ¥è³‡è¨Šã€‚è«‹é»žæ“Š MYSQL_PUBLIC_URL æ—é‚Šçš„ã€Œçœ¼ç›ã€åœ–ç¤ºï¼ˆðŸ‘ï¸ï¼‰ï¼Œè®“æˆ‘ç¢ºèªå®Œæ•´çš„ URL...
å®Œç¾Žï¼æˆ‘çœ‹åˆ°å®Œæ•´çš„é€£æŽ¥è³‡è¨Šäº†ï¼š
Plain Text
mysql://root:NCrfEbBAwIXZSJDHULrmZSJSwJKTqmyy@magley-proxy.rlwy.net:49836/railway
é€£æŽ¥è³‡è¨Šï¼š
Host: magley-proxy.rlwy.netï¼ˆä¸æ˜¯ mysql-agalev.proxy.rlwy.netï¼‰
Port: 49836
User: root
Password: NCrfEbBAwIXZSJDHULrmZSJSwJKTqmyy
Database: railway
ç¾åœ¨æˆ‘éœ€è¦æ›´æ–° GitHub Actions workflow ä¸­çš„ä¸»æ©Ÿåç¨±ã€‚è®“æˆ‘ç«‹å³ä¿®æ­£...
ç™¼ç¾ Railway çš„ MySQL ä¸»æ©Ÿåç¨±å·²è®Šæ›´ç‚º `magley-proxy.rlwy.net`ï¼Œæˆ‘å°‡æ›´æ–° workflow è£¡çš„é€£æŽ¥è³‡è¨Šï¼Œä¸¦æº–å‚™é‡æ–°åŸ·è¡Œã€‚

å·²æ›´æ–° workflow ä¸­çš„ MySQL ä¸»æ©Ÿåç¨±ç‚º magley-proxy.rlwy.netï¼Œä¸¦ç”¨ gh CLI æˆåŠŸæŽ¨é€ä¿®æ”¹ã€‚ä¸‹ä¸€æ­¥é©—è­‰è³‡æ–™åº«é€£æŽ¥ã€‚

å·²æ›´æ–° workflow æª”æ¡ˆï¼Œä¸‹ä¸€æ­¥éœ€ç¢ºèª GitHub ç™»å…¥ç‹€æ…‹ï¼Œå†é€²è¡ŒæŽ¨é€åŠé©—è­‰è³‡æ–™åº«é€£æŽ¥ã€‚

âœ… å·²ä¿®æ­£ MySQL ä¸»æ©Ÿåç¨±ï¼
æˆ‘å·²ç¶“æ›´æ–°äº† workflow æª”æ¡ˆï¼Œå°‡ä¸»æ©Ÿåç¨±å¾ž mysql-agalev.proxy.rlwy.net æ”¹ç‚º magley-proxy.rlwy.netã€‚
ç¾åœ¨è«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿæ›´æ–° GitHub ä¸Šçš„æª”æ¡ˆï¼š
ðŸ“ æ›´æ–° GitHub ä¸Šçš„ Workflow
æ–¹æ³• 1ï¼šç›´æŽ¥ç·¨è¼¯ï¼ˆæœ€å¿«ï¼‰
å›žåˆ° GitHubï¼Œå‰å¾€ .github/workflows/init-database.yml æª”æ¡ˆ
é»žæ“Šç·¨è¼¯æŒ‰éˆ•ï¼ˆé‰›ç­†åœ–ç¤ºï¼‰
æ‰¾åˆ°ç¬¬ 217 è¡Œå’Œç¬¬ 228 è¡Œï¼Œå°‡ï¼š
Plain Text
MYSQL_HOST: mysql-agalev.proxy.rlwy.net
æ”¹ç‚ºï¼š
Plain Text
MYSQL_HOST: magley-proxy.rlwy.net
æäº¤è®Šæ›´
æ–¹æ³• 2ï¼šé‡æ–°ä¸Šå‚³ï¼ˆå¦‚æžœç·¨è¼¯å›°é›£ï¼‰
åˆªé™¤èˆŠçš„ init-database.yml æª”æ¡ˆ
ä¸Šå‚³æˆ‘æä¾›çš„æ–°æª”æ¡ˆ init-database-updated.yml
ç¢ºä¿è·¯å¾‘æ˜¯ .github/workflows/init-database.yml
æ›´æ–°å®Œæˆå¾Œï¼Œè«‹ï¼š
å‰å¾€ Actions æ¨™ç±¤
é»žæ“Šã€ŒInitialize Databaseã€
é»žæ“Šã€ŒRun workflowã€
åŸ·è¡Œä¸¦æŸ¥çœ‹çµæžœ
æ‚¨æƒ³ç”¨å“ªä¸€ç¨®æ–¹æ³•å‘¢ï¼Ÿ
init-database-updated.yml
ç¨‹å¼ç¢¼ Â· 9.20 KB

æŸ¥çœ‹æ­¤ä»»å‹™ä¸­çš„æ‰€æœ‰æª”æ¡ˆ
Manus å°‡åœ¨ä½ å›žè¦†å¾Œç¹¼çºŒå·¥ä½œ
å‚³é€è¨Šæ¯çµ¦ Manus

init-database-updated.yml
name: Initialize Database

on:
  workflow_dispatch:  # æ‰‹å‹•è§¸ç™¼

jobs:
  init-db:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install MySQL client
        run: |
          sudo apt-get update
          sudo apt-get install -y mysql-client
      
      - name: Create SQL script
        run: |
          cat > init.sql << 'EOF'
          CREATE TABLE IF NOT EXISTS users (
            id int AUTO_INCREMENT PRIMARY KEY,
            openId varchar(64) UNIQUE,
            name text,
            email varchar(320),
            loginMethod varchar(64),
            role enum('user','merchant','admin') NOT NULL DEFAULT 'user',
            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
            lastSignedIn timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
            phone varchar(20) UNIQUE,
            deviceId varchar(64),
            deviceBoundAt timestamp
          );

          CREATE TABLE IF NOT EXISTS restaurants (
            id int AUTO_INCREMENT PRIMARY KEY,
            name varchar(255) NOT NULL,
            address text NOT NULL,
            latitude varchar(50),
            longitude varchar(50),
            phone varchar(20),
            description text,
            photoUrl text,
            operatingHours text NOT NULL,
            providesCheckInReward boolean NOT NULL DEFAULT false,
            isActive boolean NOT NULL DEFAULT true,
            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
          );

          CREATE TABLE IF NOT EXISTS coupons (
            id int AUTO_INCREMENT PRIMARY KEY,
            restaurantId int NOT NULL,
            title varchar(255) NOT NULL,
            description text NOT NULL,
            type enum('discount','gift','cashback') NOT NULL DEFAULT 'discount',
            expiresAt timestamp,
            isActive boolean NOT NULL DEFAULT true,
            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
          );

          CREATE TABLE IF NOT EXISTS spin_history (
            id int AUTO_INCREMENT PRIMARY KEY,
            userId int NOT NULL,
            restaurantId int NOT NULL,
            couponId int,
            mealPeriod enum('breakfast','lunch','afternoon_tea','dinner','late_night') NOT NULL,
            isShared boolean DEFAULT false NOT NULL,
            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP
          );

          CREATE TABLE IF NOT EXISTS coupon_redemptions (
            id int AUTO_INCREMENT PRIMARY KEY,
            userId int NOT NULL,
            restaurantId int NOT NULL,
            couponId int NOT NULL,
            spinHistoryId int,
            redeemedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP
          );

          CREATE TABLE IF NOT EXISTS check_in_records (
            id int AUTO_INCREMENT PRIMARY KEY,
            userId int NOT NULL,
            checkInDate varchar(10) NOT NULL,
            consecutiveDays int NOT NULL DEFAULT 1,
            rewardClaimed boolean NOT NULL DEFAULT false,
            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP
          );

          CREATE TABLE IF NOT EXISTS push_notifications (
            id int AUTO_INCREMENT PRIMARY KEY,
            title varchar(255) NOT NULL,
            content text NOT NULL,
            imageUrl text,
            couponId int,
            status enum('draft','scheduled','sent') NOT NULL DEFAULT 'draft',
            scheduledAt timestamp,
            sentAt timestamp,
            createdBy int NOT NULL,
            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
          );

          CREATE TABLE IF NOT EXISTS user_notification_reads (
            id int AUTO_INCREMENT PRIMARY KEY,
            userId int NOT NULL,
            notificationId int NOT NULL,
            readAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP
          );

          CREATE TABLE IF NOT EXISTS system_settings (
            id int AUTO_INCREMENT PRIMARY KEY,
            \`key\` varchar(100) NOT NULL UNIQUE,
            value text,
            description text,
            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
          );

          CREATE TABLE IF NOT EXISTS spin_limits (
            id int AUTO_INCREMENT PRIMARY KEY,
            userId int NOT NULL,
            date varchar(10) NOT NULL,
            mealPeriod enum('breakfast','lunch','afternoon_tea','dinner','late_night') NOT NULL,
            usedCount int NOT NULL DEFAULT 0,
            dailyCouponCount int NOT NULL DEFAULT 0,
            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
          );

          CREATE TABLE IF NOT EXISTS custom_wheel_styles (
            id int AUTO_INCREMENT PRIMARY KEY,
            name varchar(255) NOT NULL,
            type enum('canvas','image') NOT NULL DEFAULT 'canvas',
            style varchar(100) NOT NULL,
            imageUrl text,
            config text,
            isDefault boolean NOT NULL DEFAULT false,
            createdBy int NOT NULL,
            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
          );

          CREATE TABLE IF NOT EXISTS merchants (
            id int AUTO_INCREMENT PRIMARY KEY,
            userId int NOT NULL UNIQUE,
            name varchar(255) NOT NULL,
            contactPhone varchar(20),
            contactEmail varchar(320),
            status enum('active','suspended','inactive') DEFAULT 'active' NOT NULL,
            notes text,
            createdBy int NOT NULL,
            createdAt timestamp DEFAULT CURRENT_TIMESTAMP NOT NULL,
            updatedAt timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,
            INDEX idx_userId (userId),
            INDEX idx_status (status)
          );

          CREATE TABLE IF NOT EXISTS merchant_restaurants (
            id int AUTO_INCREMENT PRIMARY KEY,
            merchantId int NOT NULL,
            restaurantId int NOT NULL,
            boundAt timestamp DEFAULT CURRENT_TIMESTAMP NOT NULL,
            boundBy int NOT NULL,
            UNIQUE KEY unique_merchant_restaurant (merchantId, restaurantId),
            INDEX idx_merchantId (merchantId),
            INDEX idx_restaurantId (restaurantId)
          );

          CREATE TABLE IF NOT EXISTS restaurant_statistics (
            id int AUTO_INCREMENT PRIMARY KEY,
            restaurantId int NOT NULL,
            date varchar(10) NOT NULL,
            totalSpins int DEFAULT 0 NOT NULL,
            breakfastSpins int DEFAULT 0 NOT NULL,
            lunchSpins int DEFAULT 0 NOT NULL,
            afternoonTeaSpins int DEFAULT 0 NOT NULL,
            dinnerSpins int DEFAULT 0 NOT NULL,
            lateNightSpins int DEFAULT 0 NOT NULL,
            couponsIssued int DEFAULT 0 NOT NULL,
            couponsRedeemed int DEFAULT 0 NOT NULL,
            redemptionRate int DEFAULT 0 NOT NULL,
            uniqueUsers int DEFAULT 0 NOT NULL,
            createdAt timestamp DEFAULT CURRENT_TIMESTAMP NOT NULL,
            updatedAt timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,
            UNIQUE KEY unique_restaurant_date (restaurantId, date),
            INDEX idx_restaurantId (restaurantId),
            INDEX idx_date (date)
          );

          CREATE TABLE IF NOT EXISTS restaurant_reviews (
            id int AUTO_INCREMENT PRIMARY KEY,
            restaurantId int NOT NULL,
            userId int NOT NULL,
            rating int NOT NULL,
            comment text,
            photoUrls text,
            isApproved boolean DEFAULT FALSE NOT NULL,
            approvedBy int,
            approvedAt timestamp,
            createdAt timestamp DEFAULT CURRENT_TIMESTAMP NOT NULL,
            updatedAt timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,
            INDEX idx_restaurantId (restaurantId),
            INDEX idx_userId (userId),
            INDEX idx_isApproved (isApproved)
          );
          EOF
      
      - name: Execute SQL script
        env:
          MYSQL_HOST: magley-proxy.rlwy.net
          MYSQL_PORT: 49836
          MYSQL_USER: root
          MYSQL_PASSWORD: NCrfEbBAwIXZSJDHULrmZSJSwJKTqmyy
          MYSQL_DATABASE: railway
        run: |
          mysql -h $MYSQL_HOST -P $MYSQL_PORT -u $MYSQL_USER -p$MYSQL_PASSWORD $MYSQL_DATABASE < init.sql
          echo "âœ… Database initialization completed!"
      
      - name: Verify tables
        env:
          MYSQL_HOST: magley-proxy.rlwy.net
          MYSQL_PORT: 49836
          MYSQL_USER: root
          MYSQL_PASSWORD: NCrfEbBAwIXZSJDHULrmZSJSwJKTqmyy
          MYSQL_DATABASE: railway
        run: |
          echo "ðŸ“‹ Verifying tables..."
          mysql -h $MYSQL_HOST -P $MYSQL_PORT -u $MYSQL_USER -p$MYSQL_PASSWORD $MYSQL_DATABASE -e "SHOW TABLES;"

How to Access and Use Manus Replay Link - Manus
